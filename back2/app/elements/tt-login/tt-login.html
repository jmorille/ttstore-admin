<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/google-signin/google-signin.html">

<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">

<polymer-element name="tt-login" attributes="clientId scopes">
  <template>

    <div>
      <google-signin clientId="{{clientId}}"
                     scopes="{{scopes}}"
                     approval_prompt="force" offline="true" height="short"
                     labelSignin="Identifiez vous"
                     theme="light">

      </google-signin>
    </div>
    <div>
      <google-signin-aware  scopes="{{scopes}}"
        on-google-signin-aware-success="{{signIn}}"
        on-google-signin-aware-signed-out="{{signedOut}}">
      </google-signin-aware>

      <p>Testing <code>google-signin-aware</code>: {{status}}</p>
    </div>

    <core-ajax id="service" url="/s/oauth2callback" handleAs="json"
               contentType="application/json"
               body="{{bodyString}}"
               method="POST"
               on-core-error="{{handleError}}"
               on-core-response="{{handleResponse}}">
    </core-ajax>






  </template>
  <script>
    'use strict';
    Polymer('tt-login', {  // jshint ignore:line
      status: 'Not granted',
      bodyString: undefined,
      signIn: function (response) {
        this.status = 'Signin granted';
        //ss
        var googleAuth = response.detail.result;
        //
        var accessToken = googleAuth.access_token;
        ///
        console.log('Signin Response', response);
        console.dir(googleAuth);
        // this.$.googleCal.displayCalendars();
        console.log('delte g-oauth-window : ', googleAuth['g-oauth-window']);
        delete googleAuth['g-oauth-window'];
        this.bodyString = JSON.stringify(googleAuth);
        this.$.service.go();
      },
      signedOut: function (event, response) {
        this.status = 'Not granted';
      },

      handleResponse: function (event, resp) {
        console.log('handleResponse', resp);
      },
      handleError: function (event, resp) {
        console.log('handleError', resp);
      }

    });

  </script>

</polymer-element>
