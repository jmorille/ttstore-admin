<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../../bower_components/core-animated-pages/transitions/slide-from-right.html">

<link rel="import" href="ttadmin-notfound.html">
<link rel="import" href="ttadmin-page-portfolio.html">
<link rel="import" href="ttadmin-home.html">

<polymer-element name="ttadmin-content" attributes="selected">

  <template>

    <core-media-query query="min-width: 640px" queryMatches="{{largeScreen}}">
    </core-media-query>

    <!-- Doc https://erikringsmuth.github.io/app-router/#/events#polymer-event-mapping-->
    <app-router mode="hash" on-activate-route-end="{{selectContentHandler}}"
                on-activate-route-start="{{activateRouteHandler}}"
                core-animated-pages transitions="slide-from-right cross-fade-all">

      <app-route path="/home">
        <template>
          <ttadmin-layout>
            <ttadmin-home  cross-fade?="{{largeScreen}}"
                           fade-scale?="{{!largeScreen}}"
                           flex ></ttadmin-home>
          </ttadmin-layout>
        </template>
      </app-route>
      <app-route path="/user">
        <template>
          <ttadmin-layout>
            <admin-search cross-fade?="{{largeScreen}}"
                          fade-scale?="{{!largeScreen}}"
                          flex></admin-search>
          </ttadmin-layout>
        </template>
      </app-route>
      <app-route path="/user/:entityid" menu-selected="/user">
        <template>
          <ttadmin-layout>
            <admin-user-edit entityid="{{entityid}}"></admin-user-edit>
          </ttadmin-layout>
        </template>
      </app-route>

      <app-route path="/portfolio">
        <template>
          <ttadmin-layout>
            <ttadmin-page-portfolio cross-fade?="{{largeScreen}}"
                                    fade-scale?="{{!largeScreen}}"
                                    flex ></ttadmin-page-portfolio>
          </ttadmin-layout>
        </template>
      </app-route>
      <app-route path="/contact">
        <template>
          <ttadmin-layout>
            <yo-greeting></yo-greeting>
          </ttadmin-layout>
        </template>
      </app-route>

      <app-route path="/order/:orderId">
        <template>
          <p>Your order number is {{orderId}}</p>
        </template>
      </app-route>


      <app-route path="*" element="ttadmin-notfound">
        <template>
          <ttadmin-notfound></ttadmin-notfound>
        </template>
      </app-route>

    </app-router>

  </template>
  <script>
    'use strict';
    Polymer('ttadmin-content', {  // jshint ignore:line

      activateRouteHandler: function (event, detail) {
        console.log('Activate Route Beding ', detail);
        var menuSelectedAttr = detail.route.attributes['menu-selected'];
        var menuSelected = menuSelectedAttr ? menuSelectedAttr.value : detail.path;
        console.log('Menu selected active route', menuSelected);
        this.selected = menuSelected;
      },
      selectContentHandler: function (event, detail) {
        console.log('selectContentHandler event : ', event);
        console.log('selectContentHandler detail : ', detail);
        // New Route
        var item = detail.route;
        this.callNodesWithFunction(item, 'pageSelected');
        // Old Route
        if (detail.oldRoute) {
          this.async(function () {
              this.callNodesWithFunction(detail.oldRoute, 'pageUnselected');
            }
          );
        }
      },

      callNodesWithFunction: function (item, searchFunc) {
        var childNodes = item;
        if (!Array.isArray(childNodes)) {
          childNodes = childNodes.querySelectorAll('*');
        }
        if (childNodes) {
          Array.prototype.forEach.call(childNodes, function (childNode) {
            if (typeof childNode[searchFunc] === 'function') {
              childNode[searchFunc]();
            }
          });
        }
      }

    });

  </script>
</polymer-element>
