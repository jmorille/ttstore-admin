upstream lb-es {
      ip_hash;
      server es:9200 weight=10 max_fails=3 fail_timeout=30s; # Reverse proxy to machine-1
   #   server 192.168.1.101:9200 weight=10 max_fails=3 fail_timeout=30s; # Reverse proxy to machine-2
}

server {
    listen 80;
    listen 443 default_server ssl spdy;

    # ssl on;
    ssl_certificate /etc/nginx/ssl/server.crt;
    ssl_certificate_key /etc/nginx/ssl/server.key;

    location / {
       root /data/wwww;
       index index.html;
       expires 0;
       etag on;
       add_header Cache-Control "private";
   }

     location /components/ {
       root /data/wwww;
       expires 1h;
       etag on;
       add_header Cache-Control "private";
     }

     location /es/ {
        rewrite  ^/es/(.*)  /$1 break;

        proxy_pass http://lb-es; # Load balance the URL location "/" to the upstream lb-subprint
        proxy_http_version 1.1;

        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;

        # proxy_read_timeout 600s;
        # proxy_buffering off;
     }

     location /status {
         stub_status;
     }


}