<!-- -->
<link rel="import" href="../../components/polymer/polymer.html">

<link rel="import" href="../../components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../tt-es/tt-es-crud.html">


<polymer-element name="tt-group-edit" attributes="entityid">


    <template>
        <tt-es-crud id="service" index="users" type="user" entity="{{data}}"></tt-es-crud>


        <section>
            <paper-icon-button icon="delete" on-tap="{{onDelete}}"></paper-icon-button>
            <paper-icon-button icon="check" on-tap="{{onSave}}"></paper-icon-button>
            <paper-icon-button icon="close" on-tap="{{onClose}}"></paper-icon-button>
        </section>


        <template bind="{{data._source}}">
            <section id="editForm">

                <paper-input floatingLabel label="First name" inputValue="{{firstname}}"></paper-input>
                <paper-input floatingLabel label="Last name" inputValue="{{ lastname}}"></paper-input>
                <paper-input floatingLabel label="Email" type="email" inputValue="{{email}}"
                             on-input-invalid="{{inputInvalid}}" on-input-valid="{{inputValid}}"
                             id="email_comp"
                             error="Input is not an email!"></paper-input>
                <paper-input floatingLabel label="Email" type="email" inputValue="{{email2}}"
                             on-input-invalid="{{inputInvalid}}" on-input-valid="{{inputValid}}"
                             id="email_comp2"
                             error="Input is not an email!"></paper-input>
                <paper-shadow z="2"></paper-shadow>
            </section>
        </template>

    </template>

    <script>
        Polymer('tt-group-edit', {
            data: undefined,
            ready: function () {

            },
            entityidChanged: function () {
                this.$.service.entityGet({_id: this.entityid});
            },

            onSave: function () {
                if (this.isValid()) {
                    console.log("entity-save", this.entity);
                    this.fire('save', this.entity);
                } else {
                    this.$.toast_validate_ko.show();
                }

            },
            onDelete: function () {
                console.log("Entity Delete");
                var entityTodel = this.entity;
                this.fire('delete', entityTodel);
                console.log("Entity Delete ------------------");
            },
            onClose: function () {
                this.fire('cancel', this.entity);
            },

            isValid: function () {
                var childNodes = this.shadowRoot.querySelectorAll('#editForm > *');
                [].forEach.call(childNodes, function (childNode, i) {
                    if (typeof childNode['checkValidity'] == 'function') {
                        var validField = childNode['checkValidity']();
                        console.log("--  : " + childNode.inputValue + " : is valid " + validField);
                        if (!validField) {
                            validFields = validField;
                            console.err("--  : " + childNode.id + " : is valid " + validField);
                        }
                    }

                });
                return true;
            }


        });
    </script>
</polymer-element>