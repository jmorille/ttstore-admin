<!-- -->
<link rel="import" href="../../components/polymer/polymer.html">


<link rel="import" href="../../components/core-field/core-field.html">

<link rel="import" href="../../components/paper-input/paper-input.html">
<link rel="import" href="../../components/paper-icon-button/paper-icon-button.html">


<link rel="import" href="tt-group-service.html">
<link rel="import" href="../tt-es-crud/tt-es-crud.html">

<link rel="import" href="../tt-table/tt-table.html">

<link rel="import" href="../../tt-pagination/tt-pagination.html">

<polymer-element name="tt-group-list" attributes="">


    <template>

        <link rel="stylesheet" href="../../components/bootstrap/dist/css/bootstrap.css" shim-shadowdom>

        <style>
            tt-column {
                text-transform: capitalize;
            }

        </style>

        <tt-group-service id="service" entities="{{data}}"></tt-group-service>


        <section horizontal layout>
            <core-field>
                <paper-input placeHolder="Search Text" inputValue="{{searchText}}"
                             on-input="{{onSearchSuggest}}"></paper-input>
                <paper-icon-button icon="search" on-tap="{{searchReset}}"></paper-icon-button>
            </core-field>
        </section>


        <tt-table data="{{data.hits}}"  on-sort="{{sortHandler}}">
            <tt-column column="firstname" sortable="$.raw">Prénom</tt-column>
            <tt-column column="lastname" sortable="$.raw">Nom</tt-column>
            <tt-column column="email" sortable >Email</tt-column>
        </tt-table>


        <tt-pagination range="{{rangesize}}"
                       from="{{searchOpt.from}}" size="{{searchOpt.size}}"
                       total="{{data.hits.total}}"
                       on-change="{{pagingHandler}}">
         </tt-pagination>



    </template>

    <script>
        Polymer('tt-group-list', {

            data: undefined,
            searchOpt: undefined,
            rangesize: 10,

            created: function () {
                //   this.searchTest = '';
//                this.entityColumns = [ { column:'firstname', sortable:'$.raw', title: 'Prénom'},
//                                       { column:'lastname', sortable:'$.raw', title: 'Nom'},
//                                       { column:'email'   }
//                                    ];
                this.searchOpt = {
                    "from": 0,
                    "size": 10,
                    "_source": ["firstname", "lastname", "email" ],
                    "sort": [  "lastname.raw:asc", "firstname.raw:asc" ]
                };

            },
            ready: function () {

            },
            search: function (optToSave) {
                var that = this;
                console.log("Search Service", this.$.service);
                this.$.service.entitySearch(this.searchOpt, function (err, resp) {
                    console.log("Search Result");
                });
            },
            searchReset: function () {
                this.search({
                    from: 0
                });
            },
            sortHandler: function (event, data, sender) {
                this.searchOpt.sort= [ data.column+":"+data.order ];
                this.$.service.entitySearch(this.searchOpt);
            },
            pagingHandler: function (e, detail, sender) {
                this.$.service.entitySearch(this.searchOpt);
            }


        });
    </script>
</polymer-element>