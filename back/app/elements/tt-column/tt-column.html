<!-- -->
<link rel="import" href="../../components/polymer/polymer.html">


<polymer-element name="tt-column" attributes="column sortable">
    <template>

        <style>
            .arrow-asc, .arrow-desc, .arrow-none {
                width: 0;
                height: 0;
                border-left: 6px solid transparent;
                border-right: 6px solid transparent;
                margin-left: 5px;
            }

            .arrow-asc {
                border-bottom: 6px solid black;
            }

            .arrow-desc {
                border-top: 6px solid black;
            }

            .arrow-none {
            }
        </style>

        <div horizontal layout>
            <div on-tap="{{sortHandler}}"
                 aria-sort="{{ (order === 'none') ? 'none' : ( order === 'asc' ? 'ascending' : 'descending' ) }}"
                 aria-label="Title: {{order === 'none' || order === 'asc' ? 'activate to sort column descending' : 'activate to sort column ascending' }}">
                <content></content>
            </div>
            <template  if="{{isSortable}}">
                  <span class="{{'arrow-'+ order}}"></span>
            </template>
        </div>


    </template>

    <script>
        Polymer('tt-column', {
            order: 'none',
            column: undefined,
            sortable: undefined,
            create: function () {
            },
            unsort: function () {
                if (this.order != 'none') {
                    this.order = 'none';
                }
            },
            switchOrder: function (order) {
                switch (this.order) {
                    case 'none':
                        return 'asc';
                    case 'desc':
                        return 'asc';
                    case 'asc':
                        return 'desc';
                    default:
                        return 'none';
                }
            },

            isSortable : function () {
                if (this.sortable === '' || this.sortable) {
                    console.error("-------- is sortable");
                    return true;
                } else   {
                    console.error("-------- is NOT sortable");
                    return false;
                }
            },
            sortHandler: function () {
                if (this.isSortable) {
                    this.order = this.switchOrder(this.order);
                }
            },
            getOrderColumn: function (column, sortable) {
                if (sortable === '') {
                    return column;
                } else if (!sortable) {
                    return;
                }
                var prefix = sortable.slice(0, 1);
                switch (prefix) {
                    case '$' :
                        return column + sortable.slice(1);
                    case '^' :
                        return sortable.slice(1) + column;
                    default :
                        return sortable;
                }
            },

            orderChanged: function (oldValue, newValue, args) {
               // console.log("--------------------- this.sortable",'oldValue=',oldValue, "newValue=", newValue, "args=", args);
                if (newValue !== 'none') {
                    this.fire('sort', {
                        order: this.order,
                        column: this.getOrderColumn(this.column, this.sortable)
                    });
                }
            }


        });
    </script>
</polymer-element>