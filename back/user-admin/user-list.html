<link rel="import" href="../components/polymer/polymer.html">

<link rel="import" href="../components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../components/paper-shadow/paper-shadow.html">

<link rel="import" href="user-service.html">
<link rel="import" href="user-service-mock.html">

<link rel="import" href="../components/page-er/page-er.html">



<polymer-element name="user-list" attributes="data">

    <template>
        <link rel="stylesheet" href="../components/bootstrap/dist/css/bootstrap.css" shim-shadowdom>
        <style>
            :host {
                display: block;
            }


            /* Firefox has some awkward fieldset styling involving width that interferes with the responsive table. */
            @-moz-document url-prefix() {
                fieldset {
                    display: table-cell;
                }
            }

        </style>


        <div>


            <div>

                <paper-icon-button icon="add" on-tap="{{entityAdd}}"></paper-icon-button>

                <paper-icon-button icon="refresh" on-tap="{{refreshList}}"></paper-icon-button>
                <paper-shadow z="2"></paper-shadow>
            </div>



            <div class="table-responsive" style="background-color: white">
                <table class="table table-striped table-bordered table-hover">
                    <thead>
                    <template repeat="{{col in columns}}">
                        <th>{{col}}</th>
                    </template>
                    </thead>
                    <tbody>
                    <template repeat="{{item in data.hits}}">
                        <tr >
                            <template bind="{{item._source as it}}">
                                <template repeat="{{col in columns}}">
                                    <td on-click="{{entityEdit}}" entity-id="{{item._id}}">{{it[col]}}</td>
                                </template>
                                <td><paper-icon-button icon="delete" on-tap="{{test}}" ></paper-icon-button></td>
                           </template>
                        </tr>

                    </template>
                    </tbody>
                </table>

                <ul class="pagination">
                    <li class="disabled"><a href="#">&laquo;</a></li>
                    <li class="active"><a href="#">1 <span class="sr-only">(current)</span></a></li>
                    <li><a href="#">2</a></li>
                    <li><a href="#">3</a></li>
                    <li><a href="#">4</a></li>
                    <li><a href="#">5</a></li>
                    <li><a href="#">&raquo;</a></li>
                </ul>
            </div>

            <paper-shadow z="2"></paper-shadow>
        </div>


        <page-er perpage="10" currentpage="3" rangeSize="9" ></page-er>


        <!-- Using Custom Elements https://github.com/addyosmani/page-er/blob/master/demos/custom.html -->
        <page-er perpage="5" currentpage="0" customTemplate>
            <div class="pagination dark" id="pagination">
                <ul>
                    <li><button class="page dark gradient" on-click="{{firstPage}}">First</button></li>
                    <li class='{{currentpage === 0 ? "disabled" : ""}}'>
                        <button class="page dark gradient" on-click="{{prevPage}}">{{previous}}</button>
                    </li>
                    <template repeat="{{n in currentRange}}">
                        <li data-item="{{n}}" on-click="{{setPage}}">
                            <button class="page dark {{n == currentpage ? 'active' : 'gradient '}}">{{n+1}}</button>
                        </li>
                    </template>
                    <li class='{{currentpage === pageCount? "disabled" : ""}}'>
                        <button class="page dark gradient" on-click="{{nextPage}}">{{next}}</button>
                    </li>
                    <li><button class="page dark gradient" on-click="{{lastPage}}">Last</button></li>
                </ul>
            </div>
        </page-er>


    </template>
    <script>

        Polymer('user-list', {
            currentRange : 10 ,
            ready: function () {
                this.columns = ['firstname', 'lastname', 'email' ];
            },
            refreshList: function () {
                this.asyncFire('entity-search');
            },
            entityEdit: function (event, data, sender) {
                console.log("--- Click to Edit ");
                console.dir(data);
                console.dir(sender);
                var toEdit = sender.attributes['entity-id'].value;
                this.asyncFire('entity-edit', { _id: toEdit });
            },
            entityAdd: function () {
                console.log("--- Click to Add ");
                this.asyncFire('entity-add');

            },
            entityDelete: function (entityId) {
                this.asyncFire('entity-delete', { _id: toEdit._id });
            },
            test : function (e) {
                console.log("#######################################");
            }


        });

    </script>


</polymer-element>