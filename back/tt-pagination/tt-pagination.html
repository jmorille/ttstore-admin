 <!--
A Polymer element for paginating model data, rendering a set of pagination controls for navigating through that serer data.

-->
<link rel="import" href="../components/polymer/polymer.html">



<polymer-element name="tt-pagination" attributes="from size total rangesize">

    <template>
        <link rel="stylesheet" href="../components/bootstrap/dist/css/bootstrap.css" shim-shadowdom>
        <style>
            :host {
                display: block;
            }

        </style>
        <div>from : {{from}}</div>
        <div>size : {{size}}</div>
        <div>total : {{total}}</div>
        <!--<div>currentpage : {{currentpage}}</div>-->
        <div>pagecount : {{pagecount}}</div>
        <ul class="pagination">
            <li on-tap="{{decrementPage}}" class="{{currentpage === 1 ? 'disabled' : '' }}"><a>&laquo;</a></li>
            <template repeat="{{n in currentRange}}">
                <li  on-tap="{{selectPage}}" pageid="{{n}}" class="{{currentpage === n ? 'active' : ''}}">
                    <a>{{n}}<template if="{{currentpage === n }}"><span class="sr-only">(current)</span></template></a>
                </li>
            </template>
            <li><a on-tap="{{incrementPage}}" class="{{currentpage === pagecount ? 'disabled' : '' }}">&raquo;</a></li>
        </ul>

    </template>
    <script>

        Polymer('tt-pagination', {

         
            ready: function () {
                this.size = this.size || 10;
                this.from = this.from || 0;
                this.currentpage = Math.floor(this.from / this.size)+1;
                this. rangesize = this.rangesize || 10;
                this.currentRange= [];
            },
            incrementPage : function () {
                this.currentpage = Math.min(this.pagecount,this.currentpage+1);
            },
            decrementPage : function () {
                this.currentpage = Math.max(1,this.currentpage-1);
            },
            selectPage : function (e, data, sender) {
                var pageid =  sender.getAttribute('pageid');
                if (pageid.startsWith('+')) {
                    var inc =  parseInt( pageid.substring(1), 10);
                    this.currentpage = Math.min(this.pagecount,this.currentpage+inc);
                } else if (pageid.startsWith('-')) {
                    var inc = parseInt(pageid.substring(1), 10);
                    this.currentpage = Math.max(1, this.currentpage - inc);
                } else if (pageid === 'first') {
                    this.currentpage = 1;
                } else if (pageid === 'last') {
                    this.currentpage = this.pagecount;
                } else {
                    this.currentpage = parseInt(pageid, 10);
                }
            },

            sizeChanged : function (e, data, sender) {
                this.pagecount = this.getPageCount();
                // Fire Search Event
                this.fireSearch();
            },
            totalChanged : function (e, data, sender) {
                this.pagecount = this.getPageCount();
            },

            pagecountChanged: function () {
                this.currentRange = this.computePageRange();
            },
            rangesizeChanged: function () {
                this.currentRange = this.computePageRange();
            },
            currentpageChanged: function () {
                this.currentRange = this.computePageRange();
                console.log("-------------- from", (this.currentpage -1) * this.size);
                this.from = (this.currentpage -1) * this.size;
                // Fire Search Event
                this.fireSearch();
            },
            fireSearch : function () {
                this.fire("change", {
                    "from": this.from,
                    "size" : this.size
                });

            },
            computePageRange: function () {
                var paginations = [];
                // Check currentpage in range
                if (this.currentpage>this.pagecount) {
                    this.currentpage = this.pagecount;
                    return paginations;
                }
                // Range
                var rangeMiddle=Math.ceil(this.rangesize/2)-1;
                var rangeMin = Math.max(1,  this.currentpage -rangeMiddle);
                var rangeMax = Math.min(this.pagecount, rangeMin + this.rangesize-1);
                // Compute range in case of reach end
                if (rangeMax-rangeMin<this.rangesize) {
                    rangeMin = Math.max(1, rangeMax-this.rangesize+1);
                }
                for ( var i = rangeMin; i <= rangeMax; i++ ) {
                    paginations.push(i);
                }

                return paginations;
            },

            getPageCount: function () {
                return Math.ceil( this.total / this.size );
            }


        });

    </script>


</polymer-element>