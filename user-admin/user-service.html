<link rel="import" href="../components/polymer/polymer.html">



<polymer-element name="user-service" attributes="host index response">


    <script src="../components/elasticsearch/elasticsearch.js"></script>
    <script src="../components/elastic.js/dist/elastic.js"></script>
    <script>

        Polymer('user-service', {
            host: 'localhost:9200',
            index: 'users',
            type : 'user',
            perPage : 10,
            pageNum : 1,
            client : null,

            get refresh() {
                return this.searchAll;
            },

            created : function() {
                this.response = [];
            },

            ready: function () {

                this.client = new elasticsearch.Client({
                    host: 'localhost:9200',
                    log: 'debug'
                });
               this.searchAll();
            },

            searchAll : function() {
                //
                var that = this;
                that.client.search({
                    index: that.index,
                    type: that.type,
                    body: {
                        query: {
                             "match_all":{}
                        }
                    }
                }).then(function (resp) {
                    var hits = resp.hits.hits;
                    console.dir(hits);
                    that.response = hits;
                }, function (err) {
                    console.trace(err.message);
                });
            },
            entityGetById : function(entityId) {
                var that = this;
                that.client.get({
                    index: that.index,
                    type: that.type,
                    id: entityId
                },  function (err, resp) {
                    if (err) {
                        console.error(err.message);
                    }
                    if (resp) {
                        console.dir(resp);
                        that.response = resp;
                    }
                });
            },
              entityCreate : function(entity) {
                var that = this;
                that.client.create({
                    index: that.index,
                    type: that.type,
                    body: entity
                }, that.entityError);
            },
            entityUpdate : function(entity, err) {
                var that = this;
                that.client.index({
                    index: that.index,
                    type: that.type,
                    id: entity._id,
                    version: entity._version,
                    body: entity._source
                }, err);
            },
              entityDelete : function(id) {
                var that = this;
                that.client.delete({
                    index: that.index,
                    type: that.type,
                    id: '1'
                }, that.entityError);
            },
            entityError : function (err, resp) {
                if (err) {
                    console.error(err.message);
                }
                if (resp) {
                    console.dir(resp);
                    this.response = resp;
                }
            }


        });

    </script>


</polymer-element>